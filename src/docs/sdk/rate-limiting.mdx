---
title: 'Rate Limiting'
sidebar_order: 3
---

Rate limits are communicated to downstream clients (both Relay and SDKs) via status codes and a custom response header. For regular rate limit responses, we emit a `[429](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429)` status code and specify a [`Retry-After`](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Retry-After) header.

In addition to `Retry-After`, Sentry (Relay) also includes a special response header `X-Sentry-Rate-Limits` containing a detailed list of all rate limits that apply per category.

```
X-Sentry-Rate-Limits: *quota_limit*, *quota_limit*, ...
```

Each *quota_limit* has the form `retry_after:categories:scope:...` with the following parameters:

- `retry_after`: Number of seconds until this rate limit expires.
- `categories`: Semicolon separated list of categories. **If empty, this limit applies to all categories**.
- `scope`: The scope that this limit applies to. Can be ignored by SDKs.
- More parameters can be added in the future.

The header may contain spaces which need to be ignored. Relay will only emit spaces after `,` to separate *quota_limits*.

**Example response** (formatted for readability):

```python
HTTP/1.1 429 Too Many Requests
Retry-After: 2700
X-Sentry-Rate-Limits:
  60:transaction:key,
  2700:default;error;security:organization
```

**Example response** (with empty categories list):

```python
HTTP/1.1 429 Too Many Requests
Retry-After: 2700
X-Sentry-Rate-Limits: 60::organization, 2700::organization
```

The `X-Sentry-Rate-Limits` header may appear in any response, regardless of status code, even `200` responses. This is to proactively inform SDKs that certain payload types are disabled before SDKs even try to send them.

## Client Enforcement

Clients are expected to honor 429 responses and rate limits communicated from Sentry by stopping data transmission until the rate limit has expired. Events, transactions and sessions during this period are to be discarded.

### Stage 1: Parse Response Headers

To detect rate limits in a response from Sentry, apply the following steps:

1. On every response, look for `X-Sentry-Rate-Limits`. If present, parse it and immediately go to Stage 2.
2. On `429` responses, look for `Retry-After`. If present, treat it like `scope=key` and `categories=[]` and go to Stage 2. It is allowed but not required to do this on other status codes.
3. Otherwise, there are no rate limits communicated by Sentry.

### Stage 2: Determine Rate Limits

The exact behavior depends on the feature level of the Client:

- Clients are generally allowed to ignore any dimension (such as `category` or `scope`) if they do not support it. However, if they have explicit support, they must obey them.
For example, an SDK without support for tracing may ignore `transaction`, but SDKs with tracing must also implement and obey the `transaction` category.
- SDKs that only support one event type can ignore `X-Sentry-Rate-Limits` and use the `Retry-After` **header to determine rate limit expiration.
- SDKs that support multiple event types must parse the `categories` dimension. For each category, they should maintain a separate limit, and another separate limit for the implicit "all" category. They can ignore the `scope`, as long as they only support one DSN per instance.
- Proxy clients like Relay should create one limit-bucket per (`category`, `scope`) combination since they both handle multiple categories and scopes.
- Categories and scopes that are unknown to the client should be ignored. The limit still applies to the known categories. Clients should expect that more will be added in the future.
- Limits where **all** categories are unknown must be ignored. Do not apply unknown categories to a default category. Note that this is distinct from limits with no category, which implicitly apply to all categories (think of this as a magic category).
- Always keep the maximum rate limit if multiple rate limits reference the same bucket. If a new rate limit is shorter than an already cached rate limit, then keep the longer one.
- Unknown dimensions must be ignored, i.e., all additional colons and text after the scope.
- `X-Sentry-Rate-Limits` returned in `200 OK` responses should be treated like on 429 responses. Sentry may choose to respond with `200 OK` regardless of a rate limit or may choose to inform a client proactively about a rate limit that is unrelated to the current request. This happens specifically for *reject-all quotas* to prevent clients from sending requests.

## Definitions

As stated earlier, SDKs can ignore the `scope` dimension. These definitions are here as a suplement to explain what the `X-Sentry-Rate-Limits` header is made of.

- **Category:** Classifies the type of data that is being counted. Arbitrary categories can be added as long as they can be inferred from the event or data being ingested.
- **Scope**: The unit / model in Sentry that quotas are enforced for.

**Scopes:**

- `organization`
- `project`
- `key`

**Categories:**

- `default`: Events with an event_type not listed explicitly below.
- `error`: Error events.
- `transaction`: Transaction type events.
- `security`: Events with event_type `csp`, `hpkp`, `expectct`, `expectstaple`
- `attachment`: Attachment bytes stored (unused for rate limiting)
- `session`: Session update events
